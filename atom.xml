<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>咖喱鹏的博客</title>
  <icon>https://www.gravatar.com/avatar/7446190ffd2ca991853bfd310549ebbe</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.linpblog.com/"/>
  <updated>2018-03-31T11:48:26.000Z</updated>
  <id>https://www.linpblog.com/</id>
  
  <author>
    <name>咖喱鹏</name>
    <email>lp1142798229@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>多年前 写了个 XXtouch 自动注册 ICloud 账号的lua 留念一下</title>
    <link href="https://www.linpblog.com/2018/03/18/%E5%A4%9A%E5%B9%B4%E5%89%8D-%E5%86%99%E4%BA%86%E4%B8%AA-XXtouch-%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%86%8C-Icloud-%E8%B4%A6%E5%8F%B7%E7%9A%84lua-%E7%95%99%E5%BF%B5%E4%B8%80%E4%B8%8B/"/>
    <id>https://www.linpblog.com/2018/03/18/多年前-写了个-XXtouch-自动注册-Icloud-账号的lua-留念一下/</id>
    <published>2018-03-18T07:34:39.000Z</published>
    <updated>2018-03-31T11:48:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>新手学习下lua 编写了个 基于 XXtouch 自动注册ICloud账号的脚本，不知道现在XXtouch 发展的怎么样了，当初刚入门IT第一个写的比较完整的小东西了。</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><p>实现了 邮箱账号随机字符，可设定邮箱长度<br>通用的三个问题设置<br>自动开关飞行模式，lua小巧强大</p><h3 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h3><p>下载地址 链接：<a href="https://pan.baidu.com/s/1gOVrLmmYmXpaTHIZGyO6AA" target="_blank" rel="noopener">https://pan.baidu.com/s/1gOVrLmmYmXpaTHIZGyO6AA</a> 密码：eai8</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>getIcloud.lua<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">local</span> confirm, selects = dialog()</span><br><span class="line">    :config(<span class="string">'test'</span>)</span><br><span class="line">    :timeout(50)</span><br><span class="line">    :add_label(<span class="string">'填写一些配置'</span>)</span><br><span class="line">:add_label(<span class="string">'iClou,这个文件夹及文件一定要有'</span>)</span><br><span class="line">    :add_label(<span class="string">'姓名是随机的'</span>)</span><br><span class="line">    :add_label(<span class="string">'如果邮箱账号是空的随机英文,也拼接数字'</span>)</span><br><span class="line">    :add_input(<span class="string">'邮箱账号'</span>, <span class="string">''</span>)</span><br><span class="line">:add_label(<span class="string">'邮箱账号是空的必填邮箱位数,数字'</span>)</span><br><span class="line">:add_input(<span class="string">'邮箱位数'</span>, <span class="string">''</span>)</span><br><span class="line">    :add_input(<span class="string">'邮箱密码'</span>, <span class="string">''</span>)</span><br><span class="line">:add_label(<span class="string">'问题答案三个必须不一样'</span>)</span><br><span class="line">    :add_input(<span class="string">'问题1'</span>, <span class="string">''</span>)</span><br><span class="line">    :add_input(<span class="string">'问题2'</span>, <span class="string">''</span>)</span><br><span class="line">:add_input(<span class="string">'问题3'</span>, <span class="string">''</span>)</span><br><span class="line">:add_label(<span class="string">'飞行模式，几次后打开飞行模式进行切换IP,填写大于5的数字,不填就为关闭'</span>)</span><br><span class="line">    :add_input(<span class="string">'飞行模式'</span>, <span class="string">''</span>)</span><br><span class="line">:add_label(<span class="string">'数字每次加1,数字不填-默认‘0001’'</span>)</span><br><span class="line">    :add_input(<span class="string">'邮箱数字'</span>, <span class="string">''</span>)</span><br><span class="line">:add_label(<span class="string">'保存文件会加上当前的时间,精确到秒'</span>)</span><br><span class="line">    :add_input(<span class="string">'保存文件'</span>, <span class="string">'user'</span>)</span><br><span class="line">:add_label(<span class="string">'脚本长时间运行，请设置好停止方式'</span>)</span><br><span class="line">    :show()</span><br><span class="line">thistime = os.date(<span class="string">"%m"</span>..<span class="string">"_"</span>..<span class="string">"%d"</span>..<span class="string">"_"</span>..<span class="string">"%H"</span>..<span class="string">"_"</span>..<span class="string">"%M"</span>..<span class="string">"_"</span>..<span class="string">"%S"</span>)</span><br><span class="line">onext = image.load_file(<span class="string">"/var/mobile/Media/1ferver/lua/scripts/iCloud/next.png"</span>);</span><br><span class="line">oeng = &#123;<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>,<span class="string">"e"</span>,<span class="string">"f"</span>,<span class="string">"g"</span>,<span class="string">"h"</span>,<span class="string">"i"</span>,<span class="string">"j"</span>,<span class="string">"k"</span>,<span class="string">"l"</span>,<span class="string">"m"</span>,<span class="string">"n"</span>,<span class="string">"o"</span>,<span class="string">"p"</span>,<span class="string">"q"</span>,<span class="string">"r"</span>,<span class="string">"s"</span>,<span class="string">"t"</span>,<span class="string">"u"</span>,<span class="string">"v"</span>,<span class="string">"w"</span>,<span class="string">"x"</span>,<span class="string">"y"</span>,<span class="string">"z"</span>&#125; --26</span><br><span class="line">writeFTPfile = <span class="string">""</span></span><br><span class="line">UNUMBER = <span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> selects[<span class="string">"邮箱数字"</span>] ==<span class="string">""</span> <span class="keyword">then</span></span><br><span class="line">UNUMBER = <span class="string">"0001"</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">UNUMBER =selects[<span class="string">"邮箱数字"</span>];</span><br><span class="line">end</span><br><span class="line">ofxmode = <span class="string">"0"</span>;</span><br><span class="line">ofxmodenumber = selects[<span class="string">"飞行模式"</span>];</span><br><span class="line">password = selects[<span class="string">"邮箱密码"</span>];</span><br><span class="line">oissue1 = selects[<span class="string">"问题1"</span>];</span><br><span class="line">oissue2 = selects[<span class="string">"问题2"</span>];</span><br><span class="line">oissue3 = selects[<span class="string">"问题3"</span>];</span><br><span class="line">luaPath = <span class="string">'/var/mobile/Media/1ferver/lua/scripts'</span></span><br><span class="line">inewicloud = image.load_file(luaPath..<span class="string">"/iCloud/icloud.png"</span>);</span><br><span class="line">isetbirth = image.load_file(luaPath..<span class="string">"/iCloud/birth.png"</span>);</span><br><span class="line">iwticname = image.load_file(luaPath..<span class="string">"/iCloud/writename.png"</span>);</span><br><span class="line">igetnewid = image.load_file(luaPath..<span class="string">"/iCloud/getid.png"</span>);</span><br><span class="line">iwtemail = image.load_file(luaPath..<span class="string">"/iCloud/writeemail.png"</span>);</span><br><span class="line">inextee = image.load_file(luaPath..<span class="string">"/iCloud/nextee.png"</span>); </span><br><span class="line">iconsent = image.load_file(luaPath..<span class="string">"/iCloud/consent.png"</span>);</span><br><span class="line">iissue = image.load_file(luaPath..<span class="string">"/iCloud/issue.png"</span>);</span><br><span class="line">ianswer = image.load_file(luaPath..<span class="string">"/iCloud/answer.png"</span>);</span><br><span class="line">isettingic = image.load_file(luaPath..<span class="string">"/iCloud/settingicloud.png"</span>);</span><br><span class="line">ilogout =  image.load_file(luaPath..<span class="string">"/iCloud/logout.png"</span>);</span><br><span class="line">ilogouttwo =  image.load_file(luaPath..<span class="string">"/iCloud/logouttwo.png"</span>);</span><br><span class="line">ilogoutthree =  image.load_file(luaPath..<span class="string">"/iCloud/logoutthree.png"</span>);</span><br><span class="line">ilogoutdel =  image.load_file(luaPath..<span class="string">"/iCloud/logoutdel.png"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> newfolder(path)</span><br><span class="line">        <span class="built_in">return</span> os.execute(<span class="string">"mkdir "</span>..path);</span><br><span class="line">    end</span><br><span class="line"><span class="keyword">function</span> newdir()</span><br><span class="line"><span class="built_in">local</span> fileinfo = file.exists(<span class="string">"/var/mobile/Media/1ferver/lua/scripts/iCloud/txt"</span>)</span><br><span class="line"><span class="keyword">if</span> fileinfo ==<span class="string">"directory"</span> <span class="keyword">then</span></span><br><span class="line"><span class="built_in">local</span> file = io.open(<span class="string">"/var/mobile/Media/1ferver/lua/scripts/iCloud/txt/"</span>..selects[<span class="string">"保存文件"</span>]..thistime..<span class="string">".txt"</span>,<span class="string">"a"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">newfolder(<span class="string">"/var/mobile/Media/1ferver/lua/scripts/iCloud/txt"</span>);</span><br><span class="line"><span class="built_in">local</span> file = io.open(<span class="string">"/var/mobile/Media/1ferver/lua/scripts/iCloud/txt/"</span>..selects[<span class="string">"保存文件"</span>]..thistime..<span class="string">".txt"</span>,<span class="string">"a"</span>)</span><br><span class="line">end</span><br><span class="line">writeFTPfile = <span class="string">"/var/mobile/Media/1ferver/lua/scripts/iCloud/txt/"</span>..selects[<span class="string">"保存文件"</span>]..thistime..<span class="string">".txt"</span>;</span><br><span class="line">end</span><br><span class="line">newdir()</span><br><span class="line">file.appends(writeFTPfile, <span class="string">"邮箱密码:"</span>..selects[<span class="string">"邮箱密码"</span>]..<span class="string">"\r\n"</span>..<span class="string">"问题1:"</span>..selects[<span class="string">"问题1"</span>]..<span class="string">"\r\n"</span>..<span class="string">"问题2:"</span>..selects[<span class="string">"问题2"</span>]..<span class="string">"\r\n"</span>..<span class="string">"问题3:"</span>..selects[<span class="string">"问题3"</span>]..<span class="string">"\r\n\r\n\r\n"</span>);</span><br><span class="line"><span class="keyword">function</span> orandom(num) </span><br><span class="line"><span class="built_in">local</span> ppotext = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span> i= 0,num <span class="keyword">do</span></span><br><span class="line"><span class="built_in">local</span> r = math.random(0, 26)</span><br><span class="line">ppotext = ppotext..oeng[r];</span><br><span class="line">end</span><br><span class="line"><span class="built_in">return</span> ppotext;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> findimgclick(images)</span><br><span class="line"><span class="built_in">local</span> x, y = screen.find_image(images)</span><br><span class="line"><span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">    touch.tap(x+5, y+5)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    sys.msleep(3000);</span><br><span class="line">    <span class="built_in">local</span> x, y = screen.find_image(images,90)</span><br><span class="line">        <span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">        touch.tap(x+5, y+5)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    sys.msleep(4000);</span><br><span class="line">    <span class="built_in">local</span> x, y = screen.find_image(images, 88)</span><br><span class="line">    <span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">        touch.tap(x+5, y+5)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    sys.msleep(4000);</span><br><span class="line">    <span class="built_in">local</span> x, y = screen.find_image(images, 85)</span><br><span class="line">    <span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">        touch.tap(x+5, y+5)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">sys.msleep(3000);</span><br><span class="line"><span class="built_in">local</span> x, y = screen.find_image(images, 80)</span><br><span class="line"><span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x+5, y+5)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">closeSetting()</span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line">    end</span><br><span class="line">    end</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> findimgone(oimages)</span><br><span class="line"><span class="built_in">local</span> x, y = screen.find_image(oimages,95)</span><br><span class="line"><span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    sys.msleep(4000);</span><br><span class="line">    <span class="built_in">local</span> x2, y2 = screen.find_image(oimages,95)</span><br><span class="line">        <span class="keyword">if</span> x2 ~= -1 and y2 ~= -1 <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="built_in">return</span> <span class="literal">false</span>;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> openIcloud()</span><br><span class="line">findimgclick(inewicloud);</span><br><span class="line">sys.msleep(10000);</span><br><span class="line"><span class="built_in">local</span> x,y = screen.find_image(isetbirth,90)</span><br><span class="line"><span class="keyword">if</span> x~= -1 and y~=-1 <span class="keyword">then</span></span><br><span class="line">touch.on(170, 767):step_len(24):step_delay(0.1):move(170,1060):off()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">findimgclick(onext);</span><br><span class="line">writeName()</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">sys.msleep(4000);</span><br><span class="line"><span class="built_in">local</span> x,y = screen.find_image(isetbirth,80)</span><br><span class="line"><span class="keyword">if</span> x~= -1 and y~=-1 <span class="keyword">then</span></span><br><span class="line">touch.on(170, 767):step_len(24):step_delay(0.1):move(170,1060):off()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">findimgclick(onext);</span><br><span class="line">writeName()</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  writeName()</span><br><span class="line">sys.msleep(4000);</span><br><span class="line"><span class="built_in">local</span> findimg = findimgone(iwticname);</span><br><span class="line"><span class="built_in">local</span> nameo = orandom(5);</span><br><span class="line"><span class="built_in">local</span> namet = orandom(4);</span><br><span class="line"><span class="keyword">if</span> findimg <span class="keyword">then</span></span><br><span class="line">sys.input_text(nameo, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(1000);</span><br><span class="line">sys.input_text(namet, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">if</span> findimg <span class="keyword">then</span></span><br><span class="line">sys.msleep(2000);</span><br><span class="line">sys.input_text(nameo, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(1000);</span><br><span class="line">sys.input_text(namet, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sys.msleep(2000);</span><br><span class="line">sys.input_text(nameo, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(1000);</span><br><span class="line">sys.input_text(namet, <span class="literal">true</span>)</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"><span class="built_in">local</span> success = file.appends(writeFTPfile, <span class="string">"姓名："</span>..nameo..<span class="string">"-"</span>..namet..<span class="string">"\r\n"</span>)</span><br><span class="line"><span class="keyword">if</span> success == <span class="literal">false</span> <span class="keyword">then</span></span><br><span class="line">    sys.alert(<span class="string">"姓名写入txt失败,请排查"</span>)</span><br><span class="line">end</span><br><span class="line">sys.msleep(5000);</span><br><span class="line">findimgclick(igetnewid)</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">findimgclick(iwtemail)</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">writeIcloud()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> writeoissue(ooissue)</span><br><span class="line">findimgclick(iissue)</span><br><span class="line">sys.msleep(2000);</span><br><span class="line">touch.tap(225, 400)</span><br><span class="line">sys.msleep(2000);</span><br><span class="line">findimgclick(ianswer)</span><br><span class="line">sys.msleep(2000);</span><br><span class="line">sys.input_text(ooissue, <span class="literal">true</span>)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> writeIcloud() </span><br><span class="line"><span class="built_in">local</span> icemail = <span class="string">""</span>;</span><br><span class="line"><span class="built_in">local</span> icemailnum = selects[<span class="string">"邮箱位数"</span>];</span><br><span class="line"><span class="keyword">if</span> selects[<span class="string">"邮箱账号"</span>] ~= <span class="string">""</span> <span class="keyword">then</span></span><br><span class="line">  icemail = selects[<span class="string">"邮箱账号"</span>]</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">if</span> icemailnum ~=<span class="string">""</span> <span class="keyword">then</span></span><br><span class="line">icemail = orandom(icemailnum-1)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">icemail = orandom(5)</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line">wicloud = icemail..UNUMBER;</span><br><span class="line">sys.input_text(wicloud, <span class="literal">true</span>)</span><br><span class="line"><span class="built_in">local</span> success = file.appends(writeFTPfile, wicloud..<span class="string">"@icloud.com\r\n"</span>)</span><br><span class="line"><span class="keyword">if</span> success == <span class="literal">false</span> <span class="keyword">then</span></span><br><span class="line">    sys.alert(<span class="string">"邮箱写入txt失败,请排查"</span>)</span><br><span class="line">end</span><br><span class="line">UNUMBER = UNUMBER+1;</span><br><span class="line">findimgclick(onext)</span><br><span class="line">sys.msleep(5000);</span><br><span class="line">findimgclick(inextee)</span><br><span class="line">sys.msleep(5000);</span><br><span class="line">sys.input_text(password, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(1000);</span><br><span class="line">sys.input_text(password, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(5000);</span><br><span class="line">writeoissue(oissue1)</span><br><span class="line">sys.msleep(1000);</span><br><span class="line">writeoissue(oissue2)</span><br><span class="line">sys.msleep(1000);</span><br><span class="line">writeoissue(oissue3)</span><br><span class="line">sys.msleep(5000);</span><br><span class="line">findimgclick(iconsent)</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">findimgclick(iconsent)</span><br><span class="line">sys.msleep(10000);</span><br><span class="line">closeSetting()</span><br><span class="line">ofxmode = ofxmode+1;</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> closeSetting()</span><br><span class="line">sys.msleep(25000);</span><br><span class="line">app.close(<span class="string">"com.apple.Preferences"</span>)</span><br><span class="line">sys.msleep(5000)</span><br><span class="line">app.open_url(<span class="string">"prefs:root=CASTLE"</span>);</span><br><span class="line">sys.msleep(5000) </span><br><span class="line">getsticloud()</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> getsticloud()</span><br><span class="line"><span class="built_in">local</span> settingicloud = findimgone(isettingic)</span><br><span class="line"><span class="keyword">if</span> settingicloud <span class="keyword">then</span></span><br><span class="line">sys.msleep(5000)</span><br><span class="line">touch.on(300, 1050):step_len(20):step_delay(0.1):move(330,400):off()</span><br><span class="line">sys.msleep(3000)</span><br><span class="line">findimgclick(ilogout) </span><br><span class="line">sys.msleep(2000);</span><br><span class="line"><span class="built_in">local</span> x, y = screen.find_image(ilogouttwo, 85)</span><br><span class="line"><span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x+5, y+5)</span><br><span class="line"><span class="built_in">local</span> x2, y2 = screen.find_image(ilogoutdel, 85) </span><br><span class="line"><span class="keyword">if</span> x2 ~= -1 and y2 ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x2+5, y2+5)</span><br><span class="line"><span class="built_in">local</span> x3, y3 = screen.find_image(ilogoutthree, 85)</span><br><span class="line"><span class="keyword">if</span> x3 ~= -1 and y3 ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x3+5, y3+5)</span><br><span class="line">sys.input_text(password, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(15000)</span><br><span class="line">closeSetting()</span><br><span class="line">openSetting()</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sys.msleep(10000)</span><br><span class="line">closeSetting()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sys.msleep(15000)</span><br><span class="line">closeSetting()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">local</span> x, y = screen.find_image(ilogouttwo, 85)</span><br><span class="line"><span class="keyword">if</span> x ~= -1 and y ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x+5, y+5)</span><br><span class="line"><span class="built_in">local</span> x2, y2 = screen.find_image(ilogoutdel, 85) </span><br><span class="line"><span class="keyword">if</span> x2 ~= -1 and y2 ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x2+5, y2+5)</span><br><span class="line"><span class="built_in">local</span> x3, y3 = screen.find_image(ilogoutthree, 85)</span><br><span class="line"><span class="keyword">if</span> x3 ~= -1 and y3 ~= -1 <span class="keyword">then</span></span><br><span class="line">touch.tap(x3+5, y3+5)</span><br><span class="line">sys.input_text(password, <span class="literal">true</span>)</span><br><span class="line">sys.msleep(15000)</span><br><span class="line">closeSetting()</span><br><span class="line">openSetting()</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sys.msleep(15000)</span><br><span class="line">closeSetting()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sys.msleep(15000)</span><br><span class="line">closeSetting()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">sys.msleep(15000)</span><br><span class="line">closeSetting()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">openSetting()</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> openSetting()</span><br><span class="line"><span class="keyword">if</span> ofxmode == ofxmodenumber <span class="keyword">then</span></span><br><span class="line">device.turn_on_airplane()</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">device.turn_off_airplane()</span><br><span class="line">ofxmode = <span class="string">"0"</span>;</span><br><span class="line">sys.msleep(3000);</span><br><span class="line">end</span><br><span class="line">app.open_url(<span class="string">"prefs:root=CASTLE"</span>);</span><br><span class="line">sys.msleep(1000)</span><br><span class="line"><span class="built_in">local</span> ppsettingicloud = findimgone(inewicloud);</span><br><span class="line"><span class="keyword">if</span> ppsettingicloud == <span class="literal">true</span> <span class="keyword">then</span></span><br><span class="line">--sys.alert(ppsettingicloud,3);</span><br><span class="line">openIcloud()</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">--sys.alert(<span class="string">"false"</span>,3);</span><br><span class="line">getsticloud()</span><br><span class="line">end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (confirm) <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"你按下了提交"</span>)</span><br><span class="line">    openSetting()</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"你没有按下提交,退出脚本"</span>)</span><br><span class="line">    os.exit()</span><br><span class="line">end</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;新手学习下lua 编写了个 基于 XXtouch 自动注册ICloud账号的脚本，不知道现在XXtouch 发展的怎么样了，当初刚入门IT第一个写的比较完整的小东西了。&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; clas
      
    
    </summary>
    
      <category term="lua" scheme="https://www.linpblog.com/categories/lua/"/>
    
    
      <category term="lua" scheme="https://www.linpblog.com/tags/lua/"/>
    
  </entry>
  
  <entry>
    <title>python sqlalchemy 入门学习</title>
    <link href="https://www.linpblog.com/2018/03/17/python-sqlalchemy-%E5%85%A5%E9%97%A8%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.linpblog.com/2018/03/17/python-sqlalchemy-入门学习/</id>
    <published>2018-03-17T11:31:53.000Z</published>
    <updated>2018-03-18T12:59:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>  新手入门Python[2.7.14] 因有一些需求使用模块 xlrd 读取表格，将数据插入SQLite</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="1-安装模块"><a href="#1-安装模块" class="headerlink" title="1.安装模块"></a>1.安装模块</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ pip install xlrd</span><br><span class="line">$ pip install sqlalchemy</span><br></pre></td></tr></table></figure><h3 id="2-码农开始工作啦"><a href="#2-码农开始工作啦" class="headerlink" title="2.码农开始工作啦"></a>2.码农开始工作啦</h3><p>SQLite因为sqlite是基于文件的数据库。<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入模块</span></span><br><span class="line">import sqlalchemy,xlrd</span><br><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line">from sqlalchemy import *</span><br><span class="line">from sqlalchemy.orm import *</span><br></pre></td></tr></table></figure></p><h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>方法1<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># database URL 形式是 sqlite://&lt;nohostname&gt;/&lt;path&gt;</span></span><br><span class="line">engine = create_engine(<span class="string">'sqlite:///test.db'</span>,<span class="built_in">echo</span>=True) <span class="comment"># [echo=True] 显示输出SQL语句到控制台(还有很多参数...)</span></span><br><span class="line"><span class="comment">#如果没有test.db 就在当前目录下创建一个连接</span></span><br></pre></td></tr></table></figure></p><p>方法2<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用内存的两种方法</span></span><br><span class="line"><span class="comment"># 1.</span></span><br><span class="line">engine = create_engine(<span class="string">'sqlite://'</span>)</span><br><span class="line"><span class="comment"># 2.</span></span><br><span class="line">engine = create_engine(<span class="string">'sqlite:///:memory:'</span>)</span><br></pre></td></tr></table></figure></p><h2 id="定义模型"><a href="#定义模型" class="headerlink" title="定义模型"></a>定义模型</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Test(Base):</span><br><span class="line">__tablename__=&apos;Test&apos; #表名 可以和类名不一致</span><br><span class="line">    id=Column(Integer,primary_key=True)</span><br><span class="line">    name=Column(String(50))</span><br><span class="line">    age=Column(Integer)</span><br></pre></td></tr></table></figure><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>使用ORM，需要首先描述表，然后把类映射到表上。在SQLAclhemy中这两步通常在一起，使用叫做Declarative的系统，可以让我们创建一个包含描述我们需要创建表的类<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#需要先创建基类</span></span><br><span class="line">Base = declarative_base()</span><br></pre></td></tr></table></figure></p><p>当声名ORM的类时，Declarative系统会使用python的元类，创建一个包含表信息的Table类（可以通过User.table_ 查看），然后通过Mapper把这个Table与ORM的类联系起来。所有ORM类的Table类都包含在一个MetaData类中，通过Base.metadata 可以查看MetaData类<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#MetaData</span></span><br><span class="line">metadata = MetaData()</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建全部的表[定义多个模型全部创建] 如果创建过了 不会重复创建</span></span><br><span class="line">Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建session对象:</span></span><br><span class="line">SessionCls =sessionmaker(<span class="built_in">bind</span>=engine)</span><br><span class="line">session = SessionCls()</span><br><span class="line"></span><br><span class="line"><span class="comment">#先数据库插入一条数据</span></span><br><span class="line">ed_test=Test(name=<span class="string">'Jones'</span>,age=<span class="string">'23'</span>)</span><br><span class="line">session.add(ed_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交即保存到数据库:</span></span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line"><span class="comment">#支持数据回滚</span></span><br><span class="line"><span class="comment">#session.rollback()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭session:</span></span><br><span class="line">session.close()</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除test表，id大于2的字段</span></span><br><span class="line"><span class="comment">#session.query(Test).filter(name.id &gt; 2).delete()</span></span><br><span class="line"><span class="comment">#查询test表下面name=liuyao的全部字段</span></span><br><span class="line"><span class="comment">#ret = session.query(User).filter_by(name='Jones').all() #list</span></span><br></pre></td></tr></table></figure></p><h2 id="表格数据插入数据库"><a href="#表格数据插入数据库" class="headerlink" title="表格数据插入数据库"></a>表格数据插入数据库</h2><p>表格数据<br><img src="/images/TIM20180317210801.png" alt="avatar"><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#插入数据库代码</span></span><br><span class="line"><span class="comment">#伸手党记得注释 上面那句 session.close() </span></span><br><span class="line">fileName = r<span class="string">"C:\Users\Administrator\Documents\test.xls"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#写个类处理表格 将第一行作为 字典的键(将中文转换为英文)</span></span><br><span class="line">class excelToDict():</span><br><span class="line">    def __init__(self,fileName):</span><br><span class="line">        self.data = []</span><br><span class="line"><span class="comment">#打开表格</span></span><br><span class="line">        book = xlrd.open_workbook(fileName)</span><br><span class="line"><span class="comment">#取得第一张表格的名字</span></span><br><span class="line">        sheet_name = book.sheet_names()[0]</span><br><span class="line"><span class="comment">#打开第一张表格</span></span><br><span class="line">        self.sheet = book.sheet_by_name(sheet_name)</span><br><span class="line">        self.head = [n.encode(<span class="string">"utf-8"</span>) <span class="keyword">for</span> n <span class="keyword">in</span> sheet.row_values(0)] <span class="comment">#第一行的数据</span></span><br><span class="line">        self.nrows =sheet.nrows  <span class="comment">#总行数</span></span><br><span class="line">        self.setHeadData = &#123;<span class="string">"名字"</span>:<span class="string">"name"</span>,<span class="string">"年龄"</span>:<span class="string">"age"</span>&#125;</span><br><span class="line">        self.setHeadName()</span><br><span class="line">    def lineadd(self):</span><br><span class="line">        index = 1</span><br><span class="line">        <span class="keyword">while</span> (index &lt; self.nrows):</span><br><span class="line">            rowData = &#123;&#125;</span><br><span class="line">            anrows = self.sheet.row_values(index)</span><br><span class="line">            <span class="keyword">for</span> n,d <span class="keyword">in</span> enumerate(self.head):</span><br><span class="line">                    rowData[d] = anrows[n]</span><br><span class="line">            self.data.append(rowData)</span><br><span class="line">            index += 1</span><br><span class="line">        <span class="built_in">return</span> self.data</span><br><span class="line">    def setHeadName(self):</span><br><span class="line">        <span class="keyword">for</span> n, d <span class="keyword">in</span> enumerate(self.head):</span><br><span class="line">            self.head[n] = self.setHeadData[d]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dataAll = excelToDict(addfileName).lineadd()</span><br><span class="line">循环插入数据</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataAll:</span><br><span class="line">    ed1_test = Test(**data)</span><br><span class="line">    session.add(ed1_test)</span><br><span class="line"><span class="comment">#提交数据并关闭连接</span></span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></p><h2 id="贴个完整的代码"><a href="#贴个完整的代码" class="headerlink" title="贴个完整的代码"></a>贴个完整的代码</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导入模块</span></span><br><span class="line">import sqlalchemy,xlrd</span><br><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line">from sqlalchemy import *</span><br><span class="line">from sqlalchemy.orm import *</span><br><span class="line">engine = create_engine(<span class="string">'sqlite:///test.db'</span>,<span class="built_in">echo</span>=True)</span><br><span class="line"></span><br><span class="line">class Test(Base):</span><br><span class="line">__tablename__=<span class="string">'Test'</span> <span class="comment">#表名 可以和类名不一致</span></span><br><span class="line">    id=Column(Integer,primary_key=True)</span><br><span class="line">    name=Column(String(50))</span><br><span class="line">    age=Column(Integer)</span><br><span class="line"></span><br><span class="line"><span class="comment">#需要先创建基类</span></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="comment">#MetaData</span></span><br><span class="line">metadata = MetaData()</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建session对象:</span></span><br><span class="line">SessionCls =sessionmaker(<span class="built_in">bind</span>=engine)</span><br><span class="line">session = SessionCls()</span><br><span class="line"></span><br><span class="line"><span class="comment">#先数据库插入一条数据</span></span><br><span class="line">ed_test=Test(name=<span class="string">'Jones'</span>,age=<span class="string">'23'</span>)</span><br><span class="line">session.add(ed_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交即保存到数据库:</span></span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fileName = r<span class="string">"C:\Users\Administrator\Documents\test.xls"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#写个类处理表格 将第一行作为 字典的键(将中文转换为英文)</span></span><br><span class="line">class excelToDict():</span><br><span class="line">    def __init__(self,fileName):</span><br><span class="line">        self.data = []</span><br><span class="line"><span class="comment">#打开表格</span></span><br><span class="line">        book = xlrd.open_workbook(fileName)</span><br><span class="line"><span class="comment">#取得第一张表格的名字</span></span><br><span class="line">        sheet_name = book.sheet_names()[0]</span><br><span class="line"><span class="comment">#打开第一张表格</span></span><br><span class="line">        self.sheet = book.sheet_by_name(sheet_name)</span><br><span class="line">        self.head = [n.encode(<span class="string">"utf-8"</span>) <span class="keyword">for</span> n <span class="keyword">in</span> sheet.row_values(0)] <span class="comment">#第一行的数据</span></span><br><span class="line">        self.nrows =sheet.nrows  <span class="comment">#总行数</span></span><br><span class="line">        self.setHeadData = &#123;<span class="string">"名字"</span>:<span class="string">"name"</span>,<span class="string">"年龄"</span>:<span class="string">"age"</span>&#125;</span><br><span class="line">        self.setHeadName()</span><br><span class="line">    def lineadd(self):</span><br><span class="line">        index = 1</span><br><span class="line">        <span class="keyword">while</span> (index &lt; self.nrows):</span><br><span class="line">            rowData = &#123;&#125;</span><br><span class="line">            anrows = self.sheet.row_values(index)</span><br><span class="line">            <span class="keyword">for</span> n,d <span class="keyword">in</span> enumerate(self.head):</span><br><span class="line">                    rowData[d] = anrows[n]</span><br><span class="line">            self.data.append(rowData)</span><br><span class="line">            index += 1</span><br><span class="line">        <span class="built_in">return</span> self.data</span><br><span class="line">    def setHeadName(self):</span><br><span class="line">        <span class="keyword">for</span> n, d <span class="keyword">in</span> enumerate(self.head):</span><br><span class="line">            self.head[n] = self.setHeadData[d]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dataAll = excelToDict(addfileName).lineadd()</span><br><span class="line">循环插入数据</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> dataAll:</span><br><span class="line">    ed1_test = Test(**data)</span><br><span class="line">    session.add(ed1_test)</span><br><span class="line"><span class="comment">#提交数据并关闭连接</span></span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;  新手入门Python[2.7.14] 因有一些需求使用模块 xlrd 读取表格，将数据插入SQLite&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Sta
      
    
    </summary>
    
      <category term="python" scheme="https://www.linpblog.com/categories/python/"/>
    
    
      <category term="python" scheme="https://www.linpblog.com/tags/python/"/>
    
  </entry>
  
</feed>
